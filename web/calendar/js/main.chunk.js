(this.webpackJsonpjournal=this.webpackJsonpjournal||[]).push([[0],{112:function(e,t,n){},113:function(e,t,n){},146:function(e,t,n){},148:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(15),s=n.n(c),o=n(60),i=n(12),u=n(29),l=r.a.createContext(),d=function(){var e=Object(a.useContext)(l),t=Object(a.useState)(""),n=Object(i.a)(t,2),c=n[0],s=n[1],o=Object(a.useState)([]),u=Object(i.a)(o,2),d=u[0],m=u[1];Object(a.useEffect)((function(){c.length>1&&e.getCustomers(c).then((function(e){m(e)}))}),[c,e]);var p=d.map((function(e){return r.a.createElement("div",{className:"fc-event rs-groups__item",key:e.id,"data-index":e.id,"data-title":e.child_name,"data-customer":e.id,"data-program":"","data-teacher":""},e.child_name)}));return r.a.createElement("div",{className:"bg-white"},r.a.createElement("input",{className:"form-control",value:c,onChange:function(e){s(e.target.value)},placeholder:"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u0432\u0432\u043e\u0434\u0438\u0442\u044c \u0438\u043c\u044f ..."}),r.a.createElement("br",null),p)},m=(n(76),function(e){var t=e.groups.map((function(e,t){return r.a.createElement("div",{className:"fc-event rs-groups__item",key:e.id,"data-index":t,"data-title":e.name,"data-program":e.program_id,"data-teacher":e.teacher_id},e.name)}));return Object(a.useEffect)((function(){var e=document.getElementById("external-events");new u.a(e,{itemSelector:".fc-event",eventData:function(e){return{index:e.getAttribute("data-index"),title:e.getAttribute("data-title"),customer_id:e.getAttribute("data-customer")||!1,customer_name:e.getAttribute("data-customer-name")||!1}}})}),[]),r.a.createElement("div",{id:"external-events"},r.a.createElement("div",{className:""},r.a.createElement("div",{className:"bg-white mg-bottom"},r.a.createElement("h4",null,"\u041f\u0443\u0441\u0442\u0430\u044f \u0433\u0440\u0443\u043f\u043f\u0430"),r.a.createElement("div",{className:"fc-event rs-groups__item","data-index":"r1","data-title":"\u0418\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435","data-program":"","data-teacher":""},"\u0417\u0430\u043d\u044f\u0442\u0438\u0435 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e..."))),r.a.createElement("div",{className:""},r.a.createElement("div",{className:"bg-white mg-bottom"},r.a.createElement("div",null,r.a.createElement("h4",null,"\u0413\u0440\u0443\u043f\u043f\u043e\u0432\u044b\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u044f"),t))),r.a.createElement("div",{className:""},r.a.createElement("div",{className:"bg-white mg-bottom"},r.a.createElement("div",null,r.a.createElement("h4",null,"\u0418\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435"),r.a.createElement(d,null)))))}),p=n(22),f=n(150),v=(n(77),function(e){var t=e.serchedCustomers,n=e.choosedCustomerName,a=e.onCustomerSearch,c=e.onCustomerChoose,s=e.onAddCustomer,o=t.map((function(e,t){return r.a.createElement("tr",{key:t,onClick:function(){return c(e.id,e.child_name)}},r.a.createElement("td",null,e.child_name))})),i=t.length>0?r.a.createElement("table",{className:"table rs-add-to-order class-detail__table-search"},r.a.createElement("tbody",{className:"rs-find-block"},o)):"";return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-10"},r.a.createElement("div",{className:"rs-order__customer"},r.a.createElement("label",{htmlFor:"class-search"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0435\u0431\u0451\u043d\u043a\u0430 \u043a \u0437\u0430\u043d\u044f\u0442\u0438\u044e"),r.a.createElement("input",{id:"class-search",onChange:a,value:n,type:"text",className:"form-control",placeholder:"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u0432\u0432\u043e\u0434\u0438\u0442\u044c \u0438\u043c\u044f ..."}),i)),r.a.createElement("div",{className:"col-md-2"},r.a.createElement(f.a,{bsStyle:"primary",onClick:s,className:"class-search__btn"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c")))}),h=(n(112),function(e){var t=Object(a.useState)(),n=Object(i.a)(t,2),c=n[0],s=n[1],o=e.customers,u=e.onDeleteCustomer,l=e.onChangeCustomerComment,d=e.onChangeCustomerScip,m=e.onChangeCustomerVisit;return Object(a.useEffect)((function(){var e=o.map((function(e,t){var n=e.scip?"rs-scip":"",a=e.visit?"rs-visit":"",c=e.delete?r.a.createElement(f.a,{onClick:function(){return u(e.id)},className:"class-customer-btn class-customer-delete"},r.a.createElement("span",{className:"glyphicon glyphicon-refresh"})):r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{onClick:function(){return u(e.id)},className:"class-customer-btn class-customer-delete"},r.a.createElement("span",{className:"glyphicon glyphicon-trash"})),r.a.createElement(f.a,{className:"class-customer-btn class-customer-scip ".concat(n),onClick:d,"data-id":e.id},r.a.createElement("span",{className:"glyphicon glyphicon-flash"})),r.a.createElement(f.a,{className:"class-customer-btn class-customer-visit ".concat(a),"data-id":e.id,onClick:m},r.a.createElement("span",{className:"glyphicon glyphicon-ok-circle"})));return r.a.createElement("tr",{key:t,className:e.delete?"rs-delete":e.add?"rs-add":""},r.a.createElement("td",null,t+1),r.a.createElement("td",{value:e.id},e.customer?e.customer.child_name:""),r.a.createElement("td",null,r.a.createElement("input",{type:"text",disabled:!!e.delete,"data-id":e.id,className:"form-control",onChange:l,value:e.comment||"",placeholder:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439 ..."})),r.a.createElement("td",null,c))}));s(e)}),[o,u,l,d,m]),r.a.createElement("tbody",null,c)}),g=n(149),b=(n(113),function(e){var t=Object(a.useContext)(l),n=e.modalIsOpen,c=e.onCloseModal,s=e.onSaveClass,o=e.onDeleteClass,u=e.currentEvent,d=e.calendarEvents,m=e.onChangeTeacher,b=e.onChangeProgram,E=e.teachers,y=e.programs,O=Object(a.useState)([]),j=Object(i.a)(O,2),C=j[0],x=j[1],_=Object(a.useState)([]),N=Object(i.a)(_,2),w=N[0],k=N[1],S=Object(a.useState)(0),P=Object(i.a)(S,2),T=P[0],D=P[1],I=Object(a.useState)(""),R=Object(i.a)(I,2),A=R[0],J=R[1];Object(a.useEffect)((function(){var e=u.extendedProps||u;if(e){var t=e.customers;x(t||[])}}),[u,d]);var F=function(e){C[e].update=!0;var t=[].concat(Object(p.a)(C.slice(0,e)),[C[e]],Object(p.a)(C.slice(e+1)));x(t)},G=E.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.surname," ",e.name," ",e.secondname)})),B=y.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.name)})),H=u.title||"\u0417\u0430\u043d\u044f\u0442\u0438\u0435 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e",L=C.length>0?"\u0421\u043f\u0438\u0441\u043e\u043a \u0434\u0435\u0442\u0435\u0439 \u043d\u0430 \u0437\u0430\u043d\u044f\u0442\u0438\u0438":"",M=C.some((function(e){return e.delete||e.add||e.update}))?r.a.createElement(f.a,{bsStyle:"success",onClick:function(){return s(C)}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"):"";return u.title?r.a.createElement(g.a,{show:n,bsSize:"large",onHide:c},r.a.createElement(g.a.Header,{closeButton:!0,style:{backgroundColor:u.backgroundColor}},r.a.createElement(g.a.Title,null,H)),r.a.createElement(g.a.Body,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-6"},r.a.createElement("label",{htmlFor:"teacher-select"},"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c"),r.a.createElement("select",{className:"form-control",value:u.teacher_id||u.extendedProps.teacher_id,onChange:m},r.a.createElement("option",{value:"0"},"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d ..."),G)),r.a.createElement("div",{className:"col-md-6"},r.a.createElement("label",{htmlFor:"teacher-select"},"\u041f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430"),r.a.createElement("select",{className:"form-control",value:u.program_id||u.extendedProps.program_id,onChange:b},r.a.createElement("option",{value:"0"},"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u0430 ..."),B))),r.a.createElement("hr",null),r.a.createElement("table",{className:"table table-bordered table-hover"},r.a.createElement("caption",null,L),r.a.createElement(h,{customers:C,onChangeCustomerComment:function(e){var t=C.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));C[t].comment=e.currentTarget.value,F(t)},onChangeCustomerScip:function(e){var t=C.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));C[t].scip=!C[t].scip,F(t)},onChangeCustomerVisit:function(e){var t=C.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));C[t].visit=!C[t].visit,F(t)},onDeleteCustomer:function(e){var t=C.findIndex((function(t){return t.id===e}));if(C[t].add){var n=[].concat(Object(p.a)(C.slice(0,t)),Object(p.a)(C.slice(t+1)));return x(n)}C[t].delete=!C[t].delete,F(t)}})),r.a.createElement("hr",null),r.a.createElement(v,{onAddCustomer:function(){if(T){if(C.findIndex((function(e){return e.id===T}))+1)return!1;var e=[].concat(Object(p.a)(C),[{id:"s".concat(T),event_id:u.id,customer_id:T,customer:{child_name:A},add:!0}]);x(e),D(0),J("")}},choosedCustomerName:A,onCustomerChoose:function(e,t){D(e),J(t),k([])},serchedCustomers:w,onCustomerSearch:function(e){D(0),J(e.target.value);var n=e.target.value.toLowerCase();if(n.length<2)return k([]);t.getCustomers(n).then((function(e){k(e)}))}})),r.a.createElement(g.a.Footer,null,r.a.createElement(f.a,{bsStyle:"danger",className:"f-left",onClick:function(){return o(u.id)}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043d\u044f\u0442\u0438\u0435"),M)):r.a.createElement(r.a.Fragment,null)}),E=n(66),y=n(20),O=n(67),j=n(68),C=n(69),x=n.n(C);n(142),n(143),n(144),n(145),n(146);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var N=function(){var e=Object(a.useContext)(l),t=Object(a.useState)(!1),n=Object(i.a)(t,2),c=n[0],s=n[1],d=Object(a.useState)({}),p=Object(i.a)(d,2),f=p[0],v=p[1],h=Object(a.useState)({}),g=Object(i.a)(h,2),C=g[0],N=g[1],w=C.events,k=C.groups,S=C.teachers,P=C.programs;Object(a.useEffect)((function(){Promise.all([e.getGroups(),e.getTeachers(),e.getPrograms()]).then((function(e){N({groups:e[0],teachers:e[1],programs:e[2]})}))}),[e]);var T=r.a.createRef(),D=function(){T.current.getApi().refetchEvents()},I=function(t){if(null===t.event.end&&!t.event.allDay){var n=+new Date(t.event.start)+36e5;t.event.setEnd(n)}e.updateEvent(t.event).then((function(e){}))};return k?r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-8"},r.a.createElement("div",{className:"bg-white"},r.a.createElement(E.a,{ref:T,locales:x.a,locale:"ru",height:"auto",defaultView:"timeGridWeek",allDayText:"\u0417\u0430\u0434\u0430\u0447\u0438",minTime:"09:00:00",maxTime:"21:00:00",timeFormat:"H(:mm)",selectable:!0,editable:!0,droppable:!0,navLinks:!0,displayEventEnd:!0,displayEventTime:!0,firstDay:1,eventLimit:!0,events:"/journal/get-events",loading:function(e){if(!e){var t=T.current.getApi().getEvents();N(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},C,{events:t}))}},eventReceive:function(t){if(null===t.event.end&&!t.event.allDay){var n=+new Date(t.event.start)+36e5;t.event.setEnd(n)}var a=k[t.event.extendedProps.index],r={title:t.event.title,teacher_id:a?a.teacher_id:null,program_id:a?a.program_id:null,customers:a?a.customers:[],start:t.event.start,end:t.event.end,allDay:t.event.allDay};t.event.extendedProps.customer_id&&(r.customers=[{customer_id:t.event.extendedProps.customer_id}]),e.createEvent(r).then((function(e){D(),t.event.remove()}))},eventClick:function(e){s(!0);var t=w.findIndex((function(t){return t.id===e.event.id}));v(w[t])},eventDrop:I,eventResize:I,eventBorderColor:"transparent",plugins:[y.d,j.a,O.a,u.b],header:{left:"prev, next",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"}}))),r.a.createElement("div",{className:"col-md-4"},r.a.createElement(m,{groups:k}))),r.a.createElement(b,{modalIsOpen:c,onCloseModal:function(){s(!1)},currentEvent:f,onChangeTeacher:function(t){var n=w.findIndex((function(e){return e.id===f.id}));w[n].teacher_id=t.target.value,e.setTeacher(w[n]).then((function(e){var t=e.teacher&&e.teacher.color||"#3788d8";w[n].setProp("backgroundColor",t),D(),v(w[n])}))},onChangeProgram:function(t){var n=t.target.options[t.target.selectedIndex].text,a=f.extendedProps.customers,r=1===a.length?"".concat(a[0].customer.child_name," - ").concat(n):n,c=w.findIndex((function(e){return e.id===f.id}));w[c].setProp("title",r),w[c].program_id=t.target.value,e.setProgram(w[c]).then((function(e){D(),v(w[c])}))},teachers:S,programs:P,calendarEvents:w,onSaveClass:function(t){var n={event_id:f.id,updCustomers:t.filter((function(e){return e.update})),delCustomers:t.filter((function(e){return e.delete})).map((function(e){return e.id})),addCustomers:t.filter((function(e){return e.add}))};e.saveData(n).then((function(e){var t=w.findIndex((function(e){return e.id===f.id}));w[t].setExtendedProp("customers",e.customers),D(),v(w[t])}))},onDeleteClass:function(t){window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u0443 \u0437\u0430\u043f\u0438\u0441\u044c?")&&e.deleteEvent(t).then((function(){D(),s(!1)}))}})):"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u044e \u043a\u0430\u043b\u0435\u043d\u0434\u0430\u0440\u044c ..."},w=n(5),k=n.n(w),S=n(14),P=n(70),T=new function e(){var t=this;Object(P.a)(this,e),this.getResource=function(){var e=Object(S.a)(k.a.mark((function e(t){var n,a,r=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,fetch(t,n);case 3:if((a=e.sent).ok){e.next=6;break}throw new Error("Could not fetch ".concat(t," , received ").concat(a.status));case 6:return e.next=8,a.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getPrograms=Object(S.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/journal/get-programs");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getGroups=Object(S.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/journal/get-groups");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getTeachers=Object(S.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/journal/get-teachers");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getCustomers=function(){var e=Object(S.a)(k.a.mark((function e(n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/journal/get-customers",{method:"POST",body:JSON.stringify({customer_name:n}),headers:{"content-type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createEvent=function(){var e=Object(S.a)(k.a.mark((function e(n){var a,r,c,s,o,i,u;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.title,r=n.start,c=n.end,s=n.allDay,o=n.teacher_id,i=n.program_id,u=n.customers,e.next=3,t.getResource("/journal/set-event",{method:"POST",body:JSON.stringify({title:a,start:r?r.getTime():null,end:c?c.getTime():null,all_day:s,teacher_id:o,program_id:i,customers:JSON.stringify(u)||!1}),headers:{"content-type":"application/json"}});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateEvent=function(){var e=Object(S.a)(k.a.mark((function e(n){var a,r,c,s,o,i,u,l;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.title,r=n.start,c=n.end,s=n.allDay,o=n.extendedProps,i=o.teacher_id,u=o.program_id,l=n.id||n.extendedProps.id,e.next=5,t.getResource("/journal/set-event",{method:"POST",body:JSON.stringify({id:l,title:a,start:r?r.getTime():null,end:c?c.getTime():null,all_day:s,teacher_id:i,program_id:u}),headers:{"content-type":"application/json"}});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteEvent=function(){var e=Object(S.a)(k.a.mark((function e(n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/journal/delete-event",{method:"POST",body:JSON.stringify({id:n}),headers:{"content-type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setTeacher=function(){var e=Object(S.a)(k.a.mark((function e(n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/journal/set-teacher",{method:"POST",body:JSON.stringify({id:n.id,teacher_id:n.teacher_id}),headers:{"content-type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setProgram=function(){var e=Object(S.a)(k.a.mark((function e(n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/journal/set-program?id=".concat(n.id,"&program_id=").concat(n.program_id,"&title=").concat(n.title),{method:"POST",body:JSON.stringify({id:n.id,program_id:n.program_id,title:n.title}),headers:{"content-type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.saveData=function(){var e=Object(S.a)(k.a.mark((function e(n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/journal/save-class",{method:"POST",body:JSON.stringify({obj:JSON.stringify(n)}),headers:{"content-type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};s.a.render(r.a.createElement(l.Provider,{value:T},r.a.createElement(N,null)),document.getElementById("root"))},71:function(e,t,n){e.exports=n(148)},76:function(e,t,n){},77:function(e,t,n){}},[[71,1,2]]]);
//# sourceMappingURL=main.289d30d1.chunk.js.map