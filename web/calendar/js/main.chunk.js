(this.webpackJsonpjournal=this.webpackJsonpjournal||[]).push([[0],{19:function(e,t,a){e.exports=a(35)},24:function(e,t,a){},25:function(e,t,a){},26:function(e,t,a){},27:function(e,t,a){},28:function(e,t,a){},33:function(e,t,a){},35:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(12),s=a.n(c),o=a(18),i=a(3),u=a(9),l=r.a.createContext(),m=function(){var e=Object(n.useContext)(l),t=Object(n.useState)(""),a=Object(i.a)(t,2),c=a[0],s=a[1],o=Object(n.useState)([]),u=Object(i.a)(o,2),m=u[0],d=u[1];Object(n.useEffect)((function(){c.length>1&&e.getCustomers(c).then((function(e){d(e)}))}),[c,e]);var p=m.map((function(e){return r.a.createElement("div",{className:"fc-event rs-groups__item",key:e.id,"data-index":e.id,"data-title":e.child_name,"data-customer":e.id,"data-program":"","data-teacher":""},e.child_name)}));return r.a.createElement("div",{className:"bg-white"},r.a.createElement("input",{className:"form-control form-control-sm",autoComplete:"off",value:c,onChange:function(e){s(e.target.value)},placeholder:"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u0432\u0432\u043e\u0434\u0438\u0442\u044c \u0438\u043c\u044f ..."}),r.a.createElement("br",null),p)},d=(a(24),function(e){var t=e.groups.map((function(e,t){return r.a.createElement("div",{className:"fc-event rs-groups__item",key:e.id,"data-index":t,"data-title":e.name,"data-program":e.program_id,"data-teacher":e.teacher_id},e.name)}));return Object(n.useEffect)((function(){var e=document.getElementById("external-events");new u.a(e,{itemSelector:".fc-event",eventData:function(e){return{index:e.getAttribute("data-index"),title:e.getAttribute("data-title"),customer_id:e.getAttribute("data-customer")||!1,customer_name:e.getAttribute("data-customer-name")||!1}}})}),[]),r.a.createElement("div",{id:"external-events"},r.a.createElement("div",{className:""},r.a.createElement("div",{className:"bg-white mg-bottom"},r.a.createElement("h4",null,"\u041f\u0443\u0441\u0442\u0430\u044f \u0433\u0440\u0443\u043f\u043f\u0430"),r.a.createElement("div",{className:"fc-event rs-groups__item","data-index":"r1","data-title":"\u0418\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435","data-program":"","data-teacher":""},"\u0417\u0430\u043d\u044f\u0442\u0438\u0435 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e..."))),r.a.createElement("div",{className:""},r.a.createElement("div",{className:"bg-white mg-bottom"},r.a.createElement("div",null,r.a.createElement("h4",null,"\u0413\u0440\u0443\u043f\u043f\u043e\u0432\u044b\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u044f"),t.length>0?t:"\u0413\u0440\u0443\u043f\u043f\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b ..."))),r.a.createElement("div",{className:""},r.a.createElement("div",{className:"bg-white mg-bottom"},r.a.createElement("div",null,r.a.createElement("h4",null,"\u0418\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435"),r.a.createElement(m,null)))))}),p=a(6),f=(a(25),function(e){var t=e.serchedCustomers,a=e.choosedCustomerName,n=e.onCustomerSearch,c=e.onCustomerChoose,s=e.onAddCustomer,o=t.map((function(e,t){return r.a.createElement("tr",{key:t,onClick:function(){return c(e.id,e.child_name)}},r.a.createElement("td",null,e.child_name))})),i=t.length>0?r.a.createElement("table",{className:"table rs-add-to-order class-detail__table-search"},r.a.createElement("tbody",{className:"rs-find-block"},o)):"";return r.a.createElement("div",{className:"row mb-4"},r.a.createElement("div",{className:"col-md-10"},r.a.createElement("div",{className:"rs-order__customer"},r.a.createElement("input",{id:"class-search",type:"text",autoComplete:"off",onChange:n,value:a,className:"form-control form-control-sm",placeholder:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0435\u0431\u0451\u043d\u043a\u0430 \u043a \u0437\u0430\u043d\u044f\u0442\u0438\u044e ..."}),i)),r.a.createElement("div",{className:"col-md-2"},r.a.createElement("button",{onClick:s,className:"btn btn-primary btn-sm w-100"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c")))}),v=(a(26),function(e){var t=Object(n.useState)(),a=Object(i.a)(t,2),c=a[0],s=a[1],o=e.customers,u=e.onDeleteCustomer,l=e.onChangeCustomerComment,m=e.onChangeCustomerScip,d=e.onChangeCustomerVisit;return Object(n.useEffect)((function(){var e=o.map((function(e,t){var a=e.scip?"rs-scip":"",n=e.visit?"rs-visit":"",c=e.delete?r.a.createElement("button",{onClick:function(){return u(e.id)},className:"btn class-customer-btn class-customer-delete"},r.a.createElement("i",{className:"fas fa-sync-alt"})):r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:function(){return u(e.id)},className:"btn class-customer-btn class-customer-delete"},r.a.createElement("i",{className:"fas fa-trash-alt"})),r.a.createElement("button",{className:"btn class-customer-btn class-customer-scip ".concat(a),onClick:m,"data-id":e.id},r.a.createElement("i",{className:"fas fa-bolt"})),r.a.createElement("button",{className:"btn class-customer-btn class-customer-visit ".concat(n),"data-id":e.id,onClick:d},r.a.createElement("i",{className:"far fa-check-circle"})));return r.a.createElement("tr",{key:t,className:e.delete?"rs-delete":e.add?"rs-add":""},r.a.createElement("td",null,t+1),r.a.createElement("td",{value:e.id},e.customer?e.customer.child_name:""),r.a.createElement("td",null,r.a.createElement("input",{type:"text",disabled:!!e.delete,"data-id":e.id,className:"form-control form-control-sm",onChange:l,value:e.comment||"",placeholder:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439 ..."})),r.a.createElement("td",null,c))}));s(e)}),[o,u,l,m,d]),r.a.createElement("tbody",null,c)}),h=(a(27),function(e){var t=e.show,a=e.modalTitle,n=e.onHide,c=t?"rs-modal-open":"rs-modal-close";return r.a.createElement("div",{className:"rs-modal ".concat(c)},r.a.createElement("div",{className:"rs-modal__wrapper"},r.a.createElement("div",{className:"rs-modal-head"},r.a.createElement("div",{className:"rs-modal-title"},a),r.a.createElement("button",{className:"close rs-modal-close-btn",type:"button",onClick:n},r.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),r.a.createElement("hr",null),e.children))}),g=(a(28),function(e){var t=Object(n.useContext)(l),a=e.modalIsOpen,c=e.onCloseModal,s=e.onSaveClass,o=e.onDeleteClass,u=e.currentEvent,m=e.calendarEvents,d=e.onChangeTeacher,g=e.onChangeProgram,b=e.teachers,E=e.programs,C=Object(n.useState)([]),_=Object(i.a)(C,2),x=_[0],O=_[1],y=Object(n.useState)([]),N=Object(i.a)(y,2),j=N[0],w=N[1],k=Object(n.useState)(0),S=Object(i.a)(k,2),T=S[0],P=S[1],D=Object(n.useState)(""),B=Object(i.a)(D,2),I=B[0],R=B[1];Object(n.useEffect)((function(){var e=u.extendedProps||u;if(e){var t=e.customers;O(t||[])}}),[u,m]);var A=function(e){x[e].update=!0;var t=[].concat(Object(p.a)(x.slice(0,e)),[x[e]],Object(p.a)(x.slice(e+1)));O(t)},J=b.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.surname," ",e.name," ",e.secondname)})),G=E.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.name)})),F=u.title||"\u0417\u0430\u043d\u044f\u0442\u0438\u0435 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e",L=x.length>0?"\u0421\u043f\u0438\u0441\u043e\u043a \u0434\u0435\u0442\u0435\u0439 \u043d\u0430 \u0437\u0430\u043d\u044f\u0442\u0438\u0438":"",H=x.some((function(e){return e.delete||e.add||e.update}))?r.a.createElement("button",{className:"btn btn-success btn-sm",onClick:function(){return s(x)}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"):"";return u.title?r.a.createElement(h,{show:a,onHide:c,modalTitle:F},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-6"},r.a.createElement("label",{htmlFor:"teacher-select"},"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c"),r.a.createElement("select",{className:"form-control form-control-sm",value:u.teacher_id||u.extendedProps.teacher_id,onChange:d},r.a.createElement("option",{value:"0"},"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d ..."),J)),r.a.createElement("div",{className:"col-md-6"},r.a.createElement("label",{htmlFor:"teacher-select"},"\u041f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430"),r.a.createElement("select",{className:"form-control form-control-sm",value:u.program_id||u.extendedProps.program_id,onChange:g},r.a.createElement("option",{value:"0"},"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u0430 ..."),G))),r.a.createElement("hr",null),r.a.createElement("table",{className:"table table-bordered table-hover table-sm"},r.a.createElement("caption",null,L),r.a.createElement(v,{customers:x,onChangeCustomerComment:function(e){var t=x.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));x[t].comment=e.currentTarget.value,A(t)},onChangeCustomerScip:function(e){var t=x.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));x[t].scip=!x[t].scip,A(t)},onChangeCustomerVisit:function(e){var t=x.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));x[t].visit=!x[t].visit,A(t)},onDeleteCustomer:function(e){var t=x.findIndex((function(t){return t.id===e}));if(x[t].add){var a=[].concat(Object(p.a)(x.slice(0,t)),Object(p.a)(x.slice(t+1)));return O(a)}x[t].delete=!x[t].delete,A(t)}})),r.a.createElement("hr",null),r.a.createElement(f,{onAddCustomer:function(){if(T){if(x.findIndex((function(e){return e.id===T}))+1)return!1;var e=[].concat(Object(p.a)(x),[{id:"s".concat(T),event_id:u.id,customer_id:T,customer:{child_name:I},add:!0}]);O(e),P(0),R("")}},choosedCustomerName:I,onCustomerChoose:function(e,t){P(e),R(t),w([])},serchedCustomers:j,onCustomerSearch:function(e){P(0),R(e.target.value);var a=e.target.value.toLowerCase();if(a.length<2)return w([]);t.getCustomers(a).then((function(e){w(e)}))}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"d-flex justify-content-between"},r.a.createElement("button",{className:"btn btn-danger btn-sm",onClick:function(){return o(u.id)}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043d\u044f\u0442\u0438\u0435"),H)):r.a.createElement(r.a.Fragment,null)}),b=a(13),E=a(5),C=a(14),_=a(15),x=a(16),O=a.n(x),y=(a(29),a(30),a(31),a(32),a(33),function(){var e=Object(n.useContext)(l),t=Object(n.useState)(!1),a=Object(i.a)(t,2),c=a[0],s=a[1],m=Object(n.useState)({}),p=Object(i.a)(m,2),f=p[0],v=p[1],h=Object(n.useState)({}),x=Object(i.a)(h,2),y=x[0],N=x[1],j=y.events,w=y.groups,k=y.teachers,S=y.programs;Object(n.useEffect)((function(){Promise.all([e.getGroups(),e.getTeachers(),e.getPrograms()]).then((function(e){N({groups:e[0],teachers:e[1],programs:e[2]})}))}),[e]);var T=r.a.createRef(),P=function(){T.current.getApi().refetchEvents()},D=function(t){if(null===t.event.end&&!t.event.allDay){var a=+new Date(t.event.start)+36e5;t.event.setEnd(a)}e.updateEvent(t.event).then((function(e){}))};return w?r.a.createElement("div",{className:"calendar-app"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-8"},r.a.createElement("div",{className:"bg-white"},r.a.createElement(b.a,{ref:T,locales:O.a,locale:"ru",height:"auto",defaultView:"timeGridWeek",allDayText:"\u0417\u0430\u0434\u0430\u0447\u0438",minTime:"09:00:00",maxTime:"21:00:00",timeFormat:"H(:mm)",selectable:!0,editable:!0,droppable:!0,navLinks:!0,displayEventEnd:!0,displayEventTime:!0,firstDay:1,eventLimit:!0,events:"".concat(e._apiBase,"/api/get-events"),loading:function(e){if(!e){var t=T.current.getApi().getEvents();N(Object(o.a)({},y,{events:t}))}},eventReceive:function(t){if(null===t.event.end&&!t.event.allDay){var a=+new Date(t.event.start)+36e5;t.event.setEnd(a)}var n=w[t.event.extendedProps.index],r={title:t.event.title,teacher_id:n?n.teacher_id:null,program_id:n?n.program_id:null,customers:n?n.customers:[],start:t.event.start,end:t.event.end,allDay:t.event.allDay};t.event.extendedProps.customer_id&&(r.customers=[{customer_id:t.event.extendedProps.customer_id}]),e.createEvent(r).then((function(e){P(),t.event.remove()}))},eventClick:function(e){s(!0);var t=j.findIndex((function(t){return t.id===e.event.id}));v(j[t])},eventDrop:D,eventResize:D,eventBorderColor:"transparent",plugins:[E.d,_.a,C.a,u.b],header:{left:"prev, next",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"}}))),r.a.createElement("div",{className:"col-md-4"},r.a.createElement(d,{groups:w}))),r.a.createElement(g,{modalIsOpen:c,onCloseModal:function(){s(!1)},currentEvent:f,onChangeTeacher:function(t){var a=j.findIndex((function(e){return e.id===f.id}));j[a].teacher_id=t.target.value,e.setTeacher(j[a]).then((function(e){var t=e.teacher&&e.teacher.color||"#3788d8";j[a].setProp("backgroundColor",t),P(),v(j[a])}))},onChangeProgram:function(t){var a=t.target.options[t.target.selectedIndex].text,n=f.extendedProps.customers,r=1===n.length?"".concat(n[0].customer.child_name," - ").concat(a):a,c=j.findIndex((function(e){return e.id===f.id}));j[c].setProp("title",r),j[c].program_id=t.target.value,e.setProgram(j[c]).then((function(e){P(),v(j[c])}))},teachers:k,programs:S,calendarEvents:j,onSaveClass:function(t){var a={event_id:f.id,updCustomers:t.filter((function(e){return e.update})),delCustomers:t.filter((function(e){return e.delete})).map((function(e){return e.id})),addCustomers:t.filter((function(e){return e.add}))};e.saveData(a).then((function(e){var t=j.findIndex((function(e){return e.id===f.id}));j[t].setExtendedProp("customers",e.customers),P(),v(j[t])}))},onDeleteClass:function(t){window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u0443 \u0437\u0430\u043f\u0438\u0441\u044c?")&&e.deleteEvent(t).then((function(){P(),s(!1)}))}})):"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u044e \u043a\u0430\u043b\u0435\u043d\u0434\u0430\u0440\u044c ..."}),N=a(2),j=a.n(N),w=a(4),k=a(17),S=new function e(){var t=this;Object(k.a)(this,e),this._apiBase="",this.getResource=function(){var e=Object(w.a)(j.a.mark((function e(t){var a,n,r=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,fetch(t,a);case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("Could not fetch ".concat(t," , received ").concat(n.status));case 6:return e.next=8,n.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getPrograms=Object(w.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("".concat(t._apiBase,"/api/get-programs"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getGroups=Object(w.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("".concat(t._apiBase,"/api/get-groups"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getTeachers=Object(w.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("".concat(t._apiBase,"/api/get-teachers"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getCustomers=function(){var e=Object(w.a)(j.a.mark((function e(a){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("".concat(t._apiBase,"/api/get-customers"),{method:"POST",body:JSON.stringify({customer_name:a}),headers:{"content-type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createEvent=function(){var e=Object(w.a)(j.a.mark((function e(a){var n,r,c,s,o,i,u;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.title,r=a.start,c=a.end,s=a.allDay,o=a.teacher_id,i=a.program_id,u=a.customers,e.next=3,t.getResource("".concat(t._apiBase,"/api/set-event"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({title:n,start:r?r.getTime():null,end:c?c.getTime():null,all_day:s,teacher_id:o,program_id:i,customers:JSON.stringify(u)||!1})});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateEvent=function(){var e=Object(w.a)(j.a.mark((function e(a){var n,r,c,s,o,i,u,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.title,r=a.start,c=a.end,s=a.allDay,o=a.extendedProps,i=o.teacher_id,u=o.program_id,l=a.id||a.extendedProps.id,e.next=5,t.getResource("".concat(t._apiBase,"/api/set-event"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:l,title:n,start:r?r.getTime():null,end:c?c.getTime():null,all_day:s,teacher_id:i,program_id:u})});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteEvent=function(){var e=Object(w.a)(j.a.mark((function e(a){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("".concat(t._apiBase,"/api/delete-event/").concat(a),{method:"DELETE"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setTeacher=function(){var e=Object(w.a)(j.a.mark((function e(a){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("".concat(t._apiBase,"/api/set-teacher"),{method:"POST",body:JSON.stringify({id:a.id,teacher_id:a.teacher_id}),headers:{"content-type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setProgram=function(){var e=Object(w.a)(j.a.mark((function e(a){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("".concat(t._apiBase,"/api/set-program?id=").concat(a.id,"&program_id=").concat(a.program_id,"&title=").concat(a.title),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:a.id,program_id:a.program_id,title:a.title})});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.saveData=function(){var e=Object(w.a)(j.a.mark((function e(a){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("".concat(t._apiBase,"/api/save-class"),{method:"POST",body:JSON.stringify({obj:JSON.stringify(a)}),headers:{"content-type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};s.a.render(r.a.createElement(l.Provider,{value:S},r.a.createElement(y,null)),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.445249d6.chunk.js.map