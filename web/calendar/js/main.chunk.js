(this.webpackJsonpjournal=this.webpackJsonpjournal||[]).push([[0],{112:function(e,t,n){},113:function(e,t,n){},146:function(e,t,n){},148:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(16),s=n.n(c),o=n(12),i=n(60),u=n(15),l=n(29),d=(n(76),function(e){var t=e.groups.map((function(e,t){return r.a.createElement("div",{className:"fc-event rs-groups__item",key:e.id,"data-index":t,"data-title":e.name,"data-program":e.program_id,"data-teacher":e.teacher_id},e.name)}));return Object(a.useEffect)((function(){var e=document.getElementById("external-events");new l.a(e,{itemSelector:".fc-event",eventData:function(e){return{index:e.getAttribute("data-index"),title:e.getAttribute("data-title"),program_id:e.getAttribute("data-program")||0,teacher_id:e.getAttribute("data-teacher")||0}}})}),[]),r.a.createElement("div",{id:"external-events"},r.a.createElement("div",{className:"col-md-12"},r.a.createElement("div",{className:"bg-white"},r.a.createElement("h4",null,"\u0418\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435"),r.a.createElement("div",{className:"fc-event rs-groups__item","data-index":"r1","data-title":"\u0418\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435","data-program":"","data-teacher":""},"\u041e\u0434\u0438\u043d\u043e\u0447\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435"))),r.a.createElement("div",{className:"col-md-12"},r.a.createElement("div",{className:"bg-white"},r.a.createElement("div",null,r.a.createElement("h4",null,"\u0413\u0440\u0443\u043f\u043f\u043e\u0432\u044b\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u044f"),t))))}),m=n(150),p=(n(77),function(e){var t=e.serchedCustomers,n=e.choosedCustomerName,a=e.onCustomerSearch,c=e.onCustomerChoose,s=e.onAddCustomer,o=t.map((function(e,t){return r.a.createElement("tr",{key:t,onClick:function(){return c(e.id,e.child_name)}},r.a.createElement("td",null,e.child_name))}));return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-10"},r.a.createElement("div",{className:"rs-order__customer"},r.a.createElement("label",{htmlFor:"class-search"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0435\u0431\u0451\u043d\u043a\u0430 \u043a \u0437\u0430\u043d\u044f\u0442\u0438\u044e"),r.a.createElement("input",{id:"class-search",onChange:a,value:n,type:"text",className:"form-control",placeholder:"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u0432\u0432\u043e\u0434\u0438\u0442\u044c \u0438\u043c\u044f ..."}),r.a.createElement("table",{className:"table rs-add-to-order"},r.a.createElement("tbody",{className:"rs-find-block"},o)))),r.a.createElement("div",{className:"col-md-2"},r.a.createElement(m.a,{bsStyle:"primary",onClick:s,className:"class-search__btn"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c")))}),f=(n(112),function(e){var t=Object(a.useState)(),n=Object(u.a)(t,2),c=n[0],s=n[1],o=e.customers,i=e.onDeleteCustomer,l=e.onChangeCustomerComment,d=e.onChangeCustomerScip,p=e.onChangeCustomerVisit;return Object(a.useEffect)((function(){var e=o.map((function(e,t){var n=e.scip?"rs-scip":"",a=e.visit?"rs-visit":"",c=e.delete?r.a.createElement(m.a,{onClick:function(){return i(e.id)},className:"class-customer-btn class-customer-delete"},r.a.createElement("span",{className:"glyphicon glyphicon-refresh"})):r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{onClick:function(){return i(e.id)},className:"class-customer-btn class-customer-delete"},r.a.createElement("span",{className:"glyphicon glyphicon-trash"})),r.a.createElement(m.a,{className:"class-customer-btn class-customer-scip ".concat(n),onClick:d,"data-id":e.id},r.a.createElement("span",{className:"glyphicon glyphicon-flash"})),r.a.createElement(m.a,{className:"class-customer-btn class-customer-visit ".concat(a),"data-id":e.id,onClick:p},r.a.createElement("span",{className:"glyphicon glyphicon-ok-circle"})));return r.a.createElement("tr",{key:t,className:e.delete?"rs-delete":e.add?"rs-add":""},r.a.createElement("td",null,t+1),r.a.createElement("td",{value:e.id},e.customer?e.customer.child_name:""),r.a.createElement("td",null,r.a.createElement("input",{type:"text",disabled:!!e.delete,"data-id":e.id,className:"form-control",onChange:l,value:e.comment||"",placeholder:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439 ..."})),r.a.createElement("td",null,c))}));s(e)}),[o,i,l,d,p]),r.a.createElement("tbody",null,c)}),h=n(149),v=(n(113),r.a.createContext()),g=function(e){var t=Object(a.useContext)(v),n=e.modalIsOpen,c=e.onCloseModal,s=e.onSaveClass,i=e.onDeleteClass,l=e.currentEvent,d=e.calendarEvents,g=e.onChangeTeacher,b=e.onChangeProgram,E=e.teachers,j=e.programs,O=Object(a.useState)([]),C=Object(u.a)(O,2),y=C[0],x=C[1],w=Object(a.useState)([]),_=Object(u.a)(w,2),k=_[0],N=_[1],D=Object(a.useState)(0),S=Object(u.a)(D,2),T=S[0],P=S[1],R=Object(a.useState)(""),I=Object(u.a)(R,2),A=I[0],G=I[1];Object(a.useEffect)((function(){var e=l.extendedProps||l;if(e){var t=e.customers;x(t||[])}}),[l,d]);var F=function(e){y[e].update=!0;var t=[].concat(Object(o.a)(y.slice(0,e)),[y[e]],Object(o.a)(y.slice(e+1)));x(t)},B=E.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.surname," ",e.name," ",e.secondname)})),J=j.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.name)})),H=y.length>0?"\u0421\u043f\u0438\u0441\u043e\u043a \u0434\u0435\u0442\u0435\u0439 \u043d\u0430 \u0437\u0430\u043d\u044f\u0442\u0438\u0438":"",L=y.some((function(e){return e.delete||e.add}))?r.a.createElement(m.a,{bsStyle:"success",onClick:function(){return s(y)}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0447\u0435\u043d\u0438\u043a\u043e\u0432"):"";return r.a.createElement(h.a,{show:n,bsSize:"large",onHide:c},r.a.createElement(h.a.Header,{closeButton:!0,style:{backgroundColor:l.backgroundColor}},r.a.createElement(h.a.Title,null,l.title||"\u0417\u0430\u043d\u044f\u0442\u0438\u0435 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e")),r.a.createElement(h.a.Body,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-6"},r.a.createElement("label",{htmlFor:"teacher-select"},"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c"),r.a.createElement("select",{className:"form-control",value:l.teacher_id,onChange:g},r.a.createElement("option",{value:"0"},"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d ..."),B)),r.a.createElement("div",{className:"col-md-6"},r.a.createElement("label",{htmlFor:"teacher-select"},"\u041f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430"),r.a.createElement("select",{className:"form-control",value:l.program_id,onChange:b},r.a.createElement("option",{value:"0"},"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u0430 ..."),J))),r.a.createElement("hr",null),r.a.createElement("table",{className:"table table-bordered table-hover"},r.a.createElement("caption",null,H),r.a.createElement(f,{customers:y,onChangeCustomerComment:function(e){var t=y.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));y[t].comment=e.currentTarget.value,F(t)},onChangeCustomerScip:function(e){var t=y.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));y[t].scip=!y[t].scip,F(t)},onChangeCustomerVisit:function(e){var t=y.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));y[t].visit=!y[t].visit,F(t)},onDeleteCustomer:function(e){var t=y.findIndex((function(t){return t.id===e}));if(y[t].add){var n=[].concat(Object(o.a)(y.slice(0,t)),Object(o.a)(y.slice(t+1)));return x(n)}y[t].delete=!y[t].delete,F(t)}})),r.a.createElement("hr",null),r.a.createElement(p,{onAddCustomer:function(){if(T){if(y.findIndex((function(e){return e.id===T}))+1)return!1;var e=[].concat(Object(o.a)(y),[{id:"s".concat(T),event_id:l.id,customer_id:T,customer:{child_name:A},add:!0}]);x(e),P(0),G("")}},choosedCustomerName:A,onCustomerChoose:function(e,t){P(e),G(t),N([])},serchedCustomers:k,onCustomerSearch:function(e){P(0),G(e.target.value);var n=e.target.value.toLowerCase();if(n.length<2)return N([]);t.getCustomers(n).then((function(e){N(e)}))}})),r.a.createElement(h.a.Footer,null,r.a.createElement(m.a,{bsStyle:"danger",className:"f-left",onClick:function(){return i(l.id)}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043d\u044f\u0442\u0438\u0435"),L))},b=n(66),E=n(21),j=n(67),O=n(68),C=n(69),y=n.n(C);n(142),n(143),n(144),n(145),n(146);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(n,!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _=function(){var e=Object(a.useContext)(v),t=Object(a.useState)(!1),n=Object(u.a)(t,2),c=n[0],s=n[1],i=Object(a.useState)({}),m=Object(u.a)(i,2),p=m[0],f=m[1],h=Object(a.useState)({}),C=Object(u.a)(h,2),x=C[0],_=C[1],k=x.events,N=x.groups,D=x.teachers,S=x.programs;Object(a.useEffect)((function(){Promise.all([e.getGroups(),e.getTeachers(),e.getPrograms(),e.getEvents()]).then((function(e){_({groups:e[0],teachers:e[1],programs:e[2],events:e[3]})}))}),[e]);var T=function(t){if(null===t.event.end&&!t.event.allDay){var n=+new Date(t.event.start)+36e5;t.event.setEnd(n)}e.updateEvent(t.event).then((function(e){var n=k.findIndex((function(t){return t.id===e.id}));e.start=t.event.start,e.end=t.event.end,e.allDay=t.event.allDay,e.backgroundColor=e.teacher&&e.teacher.color||"#3788d8",_(w({},x,{events:[].concat(Object(o.a)(k.slice(0,n)),[e],Object(o.a)(k.slice(n+1)))}))}))},P=function(e){var t=k.findIndex((function(e){return e.id===p.id}));e.backgroundColor=e.teacher&&e.teacher.color||"#3788d8",e.start=k[t].start,e.end=k[t].end,e.allDay=k[t].allDay,f(e),_(w({},x,{events:[].concat(Object(o.a)(k.slice(0,t)),[e],Object(o.a)(k.slice(t+1)))}))};return N?r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-8"},r.a.createElement("div",{className:"bg-white"},r.a.createElement(b.a,{locales:y.a,locale:"ru",height:"auto",defaultView:"timeGridWeek",allDayText:"\u0417\u0430\u0434\u0430\u0447\u0438",minTime:"09:00:00",maxTime:"21:00:00",timeFormat:"H(:mm)",selectable:!0,editable:!0,droppable:!0,navLinks:!0,displayEventEnd:!0,displayEventTime:!0,firstDay:1,eventLimit:!0,events:k,datesRender:function(e){console.log("changeDate",e)},eventReceive:function(t){if(null===t.event.end&&!t.event.allDay){var n=+new Date(t.event.start)+36e5;t.event.setEnd(n)}var a=N[t.event.extendedProps.index],r={title:t.event.title,teacher_id:t.event.teacher_id,program_id:t.event.program_id,customers:a?a.customers:[],start:t.event.start,end:t.event.end,allDay:t.event.allDay};e.createEvent(r).then((function(e){r.id=""+e.id,r.customers=e.customers,r.color=e.teacher&&e.teacher.color||"#3788d8",_(w({},x,{events:[].concat(Object(o.a)(k),[r])})),t.event.remove()}))},eventClick:function(e){s(!0);var t=k.findIndex((function(t){return t.id===e.event.id}));f(k[t])},eventDrop:T,eventResize:T,eventBorderColor:"transparent",plugins:[E.d,O.a,j.a,l.b],header:{left:"prev, next",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"}}))),r.a.createElement("div",{className:"col-md-4"},r.a.createElement(d,{groups:N}))),r.a.createElement(g,{modalIsOpen:c,onCloseModal:function(){s(!1)},currentEvent:p,onChangeTeacher:function(t){p.teacher_id=t.target.value,e.setTeacher(p).then((function(e){P(e)}))},onChangeProgram:function(t){p.title=t.target.options[t.target.selectedIndex].text,p.program_id=t.target.value,e.setProgram(p).then((function(e){P(e)}))},teachers:D,programs:S,calendarEvents:k,onSaveClass:function(t){var n={event_id:p.id,updCustomers:t.filter((function(e){return e.update})),delCustomers:t.filter((function(e){return e.delete})).map((function(e){return e.id})),addCustomers:t.filter((function(e){return e.add}))};e.saveData(n).then((function(e){P(e)}))},onDeleteClass:function(t){window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u0443 \u0437\u0430\u043f\u0438\u0441\u044c?")&&e.deleteEvent(t).then((function(){var e=k.findIndex((function(e){return e.id===p.id}));_(w({},x,{events:[].concat(Object(o.a)(k.slice(0,e)),Object(o.a)(k.slice(e+1)))})),s(!1)}))}})):"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u044e \u043a\u0430\u043b\u0435\u043d\u0434\u0430\u0440\u044c ..."},k=n(5),N=n.n(k),D=n(14),S=n(70),T=new function e(){var t=this;Object(S.a)(this,e),this.getResource=function(){var e=Object(D.a)(N.a.mark((function e(t){var n,a,r=arguments;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,fetch(t,n);case 3:if((a=e.sent).ok){e.next=6;break}throw new Error("Could not fetch ".concat(t," , received ").concat(a.status));case 6:return e.next=8,a.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getEvents=Object(D.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/get-events");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getPrograms=Object(D.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/get-programs");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getGroups=Object(D.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/get-groups");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getTeachers=Object(D.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/get-teachers");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getCustomers=function(){var e=Object(D.a)(N.a.mark((function e(n){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/get-customers?customer_name=".concat(n),{method:"GET"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createEvent=function(){var e=Object(D.a)(N.a.mark((function e(n){var a,r,c,s,o,i,u,l,d;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.title,r=n.start,c=n.end,s=n.allDay,o=n.teacher_id,i=n.program_id,u=n.customers,l=r?r.getTime():null,d=c?c.getTime():null,e.next=5,t.getResource("https://schaste-crm/journal/set-event?title=".concat(a,"&start=").concat(l,"&end=").concat(d,"&all_day=").concat(s,"&teacher_id=").concat(o,"&program_id=").concat(i,"&customers=").concat(JSON.stringify(u)||!1),{method:"GET"});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateEvent=function(){var e=Object(D.a)(N.a.mark((function e(n){var a,r,c,s,o,i,u,l,d,m;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.title,r=n.start,c=n.end,s=n.allDay,o=n.extendedProps,i=o.teacher_id,u=o.program_id,l=r?r.getTime():null,d=c?c.getTime():null,m=n.id||n.extendedProps.id,e.next=7,t.getResource("https://schaste-crm/journal/set-event?id=".concat(m,"&title=").concat(a,"&start=").concat(l,"&end=").concat(d,"&all_day=").concat(s,"&teacher_id=").concat(i,"&program_id=").concat(u),{method:"GET"});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteEvent=function(){var e=Object(D.a)(N.a.mark((function e(n){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/delete-event?id=".concat(n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setTeacher=function(){var e=Object(D.a)(N.a.mark((function e(n){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/set-teacher?id=".concat(n.id,"&teacher_id=").concat(n.teacher_id,"}"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setProgram=function(){var e=Object(D.a)(N.a.mark((function e(n){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/set-program?id=".concat(n.id,"&program_id=").concat(n.program_id,"&title=").concat(n.title));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.saveData=function(){var e=Object(D.a)(N.a.mark((function e(n){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/save-class?obj=".concat(JSON.stringify(n)));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};s.a.render(r.a.createElement(v.Provider,{value:T},r.a.createElement(_,null)),document.getElementById("root"))},71:function(e,t,n){e.exports=n(148)},76:function(e,t,n){},77:function(e,t,n){}},[[71,1,2]]]);
//# sourceMappingURL=main.1018e875.chunk.js.map