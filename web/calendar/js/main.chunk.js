(this.webpackJsonpjournal=this.webpackJsonpjournal||[]).push([[0],{112:function(e,t,a){},113:function(e,t,a){},144:function(e,t,a){},146:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(14),s=a.n(c),o=a(70),i=a(12),l=a(28),u=r.a.createContext(),d=function(){var e=Object(n.useContext)(u),t=Object(n.useState)(""),a=Object(i.a)(t,2),c=a[0],s=a[1],o=Object(n.useState)([]),l=Object(i.a)(o,2),d=l[0],m=l[1];Object(n.useEffect)((function(){c.length>1&&e.getCustomers(c).then((function(e){m(e)}))}),[c,e]);var p=d.map((function(e){return r.a.createElement("div",{className:"fc-event rs-groups__item",key:e.id,"data-index":e.id,"data-title":e.child_name,"data-customer":e.id,"data-program":"","data-teacher":""},e.child_name)}));return r.a.createElement("div",{className:"bg-white"},r.a.createElement("input",{className:"form-control",value:c,onChange:function(e){s(e.target.value)},placeholder:"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u0432\u0432\u043e\u0434\u0438\u0442\u044c \u0438\u043c\u044f ..."}),r.a.createElement("br",null),p)},m=(a(76),function(e){var t=e.groups.map((function(e,t){return r.a.createElement("div",{className:"fc-event rs-groups__item",key:e.id,"data-index":t,"data-title":e.name,"data-program":e.program_id,"data-teacher":e.teacher_id},e.name)}));return Object(n.useEffect)((function(){var e=document.getElementById("external-events");new l.a(e,{itemSelector:".fc-event",eventData:function(e){return{index:e.getAttribute("data-index"),title:e.getAttribute("data-title"),customer_id:e.getAttribute("data-customer")||!1,customer_name:e.getAttribute("data-customer-name")||!1}}})}),[]),r.a.createElement("div",{id:"external-events"},r.a.createElement("div",{className:""},r.a.createElement("div",{className:"bg-white mg-bottom"},r.a.createElement("h4",null,"\u041f\u0443\u0441\u0442\u0430\u044f \u0433\u0440\u0443\u043f\u043f\u0430"),r.a.createElement("div",{className:"fc-event rs-groups__item","data-index":"r1","data-title":"\u0418\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435","data-program":"","data-teacher":""},"\u0417\u0430\u043d\u044f\u0442\u0438\u0435 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e..."))),r.a.createElement("div",{className:""},r.a.createElement("div",{className:"bg-white mg-bottom"},r.a.createElement("div",null,r.a.createElement("h4",null,"\u0413\u0440\u0443\u043f\u043f\u043e\u0432\u044b\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u044f"),t.length>0?t:"\u0413\u0440\u0443\u043f\u043f\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b ..."))),r.a.createElement("div",{className:""},r.a.createElement("div",{className:"bg-white mg-bottom"},r.a.createElement("div",null,r.a.createElement("h4",null,"\u0418\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435"),r.a.createElement(d,null)))))}),p=a(21),f=a(148),v=(a(77),function(e){var t=e.serchedCustomers,a=e.choosedCustomerName,n=e.onCustomerSearch,c=e.onCustomerChoose,s=e.onAddCustomer,o=t.map((function(e,t){return r.a.createElement("tr",{key:t,onClick:function(){return c(e.id,e.child_name)}},r.a.createElement("td",null,e.child_name))})),i=t.length>0?r.a.createElement("table",{className:"table rs-add-to-order class-detail__table-search"},r.a.createElement("tbody",{className:"rs-find-block"},o)):"";return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-10"},r.a.createElement("div",{className:"rs-order__customer"},r.a.createElement("label",{htmlFor:"class-search"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0435\u0431\u0451\u043d\u043a\u0430 \u043a \u0437\u0430\u043d\u044f\u0442\u0438\u044e"),r.a.createElement("input",{id:"class-search",onChange:n,value:a,type:"text",className:"form-control",placeholder:"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u0432\u0432\u043e\u0434\u0438\u0442\u044c \u0438\u043c\u044f ..."}),i)),r.a.createElement("div",{className:"col-md-2"},r.a.createElement(f.a,{bsStyle:"primary",onClick:s,className:"class-search__btn"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c")))}),h=(a(112),function(e){var t=Object(n.useState)(),a=Object(i.a)(t,2),c=a[0],s=a[1],o=e.customers,l=e.onDeleteCustomer,u=e.onChangeCustomerComment,d=e.onChangeCustomerScip,m=e.onChangeCustomerVisit;return Object(n.useEffect)((function(){var e=o.map((function(e,t){var a=e.scip?"rs-scip":"",n=e.visit?"rs-visit":"",c=e.delete?r.a.createElement(f.a,{onClick:function(){return l(e.id)},className:"class-customer-btn class-customer-delete"},r.a.createElement("span",{className:"glyphicon glyphicon-refresh"})):r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{onClick:function(){return l(e.id)},className:"class-customer-btn class-customer-delete"},r.a.createElement("span",{className:"glyphicon glyphicon-trash"})),r.a.createElement(f.a,{className:"class-customer-btn class-customer-scip ".concat(a),onClick:d,"data-id":e.id},r.a.createElement("span",{className:"glyphicon glyphicon-flash"})),r.a.createElement(f.a,{className:"class-customer-btn class-customer-visit ".concat(n),"data-id":e.id,onClick:m},r.a.createElement("span",{className:"glyphicon glyphicon-ok-circle"})));return r.a.createElement("tr",{key:t,className:e.delete?"rs-delete":e.add?"rs-add":""},r.a.createElement("td",null,t+1),r.a.createElement("td",{value:e.id},e.customer?e.customer.child_name:""),r.a.createElement("td",null,r.a.createElement("input",{type:"text",disabled:!!e.delete,"data-id":e.id,className:"form-control",onChange:u,value:e.comment||"",placeholder:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439 ..."})),r.a.createElement("td",null,c))}));s(e)}),[o,l,u,d,m]),r.a.createElement("tbody",null,c)}),g=a(147),E=(a(113),function(e){var t=Object(n.useContext)(u),a=e.modalIsOpen,c=e.onCloseModal,s=e.onSaveClass,o=e.onDeleteClass,l=e.currentEvent,d=e.calendarEvents,m=e.onChangeTeacher,E=e.onChangeProgram,b=e.teachers,y=e.programs,C=Object(n.useState)([]),_=Object(i.a)(C,2),x=_[0],O=_[1],N=Object(n.useState)([]),j=Object(i.a)(N,2),w=j[0],S=j[1],k=Object(n.useState)(0),P=Object(i.a)(k,2),T=P[0],D=P[1],B=Object(n.useState)(""),I=Object(i.a)(B,2),R=I[0],A=I[1];Object(n.useEffect)((function(){var e=l.extendedProps||l;if(e){var t=e.customers;O(t||[])}}),[l,d]);var J=function(e){x[e].update=!0;var t=[].concat(Object(p.a)(x.slice(0,e)),[x[e]],Object(p.a)(x.slice(e+1)));O(t)},F=b.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.surname," ",e.name," ",e.secondname)})),G=y.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.name)})),L=l.title||"\u0417\u0430\u043d\u044f\u0442\u0438\u0435 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e",H=x.length>0?"\u0421\u043f\u0438\u0441\u043e\u043a \u0434\u0435\u0442\u0435\u0439 \u043d\u0430 \u0437\u0430\u043d\u044f\u0442\u0438\u0438":"",M=x.some((function(e){return e.delete||e.add||e.update}))?r.a.createElement(f.a,{bsStyle:"success",onClick:function(){return s(x)}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"):"";return l.title?r.a.createElement(g.a,{show:a,bsSize:"large",onHide:c},r.a.createElement(g.a.Header,{closeButton:!0,style:{backgroundColor:l.backgroundColor}},r.a.createElement(g.a.Title,null,L)),r.a.createElement(g.a.Body,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-6"},r.a.createElement("label",{htmlFor:"teacher-select"},"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c"),r.a.createElement("select",{className:"form-control",value:l.teacher_id||l.extendedProps.teacher_id,onChange:m},r.a.createElement("option",{value:"0"},"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d ..."),F)),r.a.createElement("div",{className:"col-md-6"},r.a.createElement("label",{htmlFor:"teacher-select"},"\u041f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430"),r.a.createElement("select",{className:"form-control",value:l.program_id||l.extendedProps.program_id,onChange:E},r.a.createElement("option",{value:"0"},"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u0430 ..."),G))),r.a.createElement("hr",null),r.a.createElement("table",{className:"table table-bordered table-hover"},r.a.createElement("caption",null,H),r.a.createElement(h,{customers:x,onChangeCustomerComment:function(e){var t=x.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));x[t].comment=e.currentTarget.value,J(t)},onChangeCustomerScip:function(e){var t=x.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));x[t].scip=!x[t].scip,J(t)},onChangeCustomerVisit:function(e){var t=x.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));x[t].visit=!x[t].visit,J(t)},onDeleteCustomer:function(e){var t=x.findIndex((function(t){return t.id===e}));if(x[t].add){var a=[].concat(Object(p.a)(x.slice(0,t)),Object(p.a)(x.slice(t+1)));return O(a)}x[t].delete=!x[t].delete,J(t)}})),r.a.createElement("hr",null),r.a.createElement(v,{onAddCustomer:function(){if(T){if(x.findIndex((function(e){return e.id===T}))+1)return!1;var e=[].concat(Object(p.a)(x),[{id:"s".concat(T),event_id:l.id,customer_id:T,customer:{child_name:R},add:!0}]);O(e),D(0),A("")}},choosedCustomerName:R,onCustomerChoose:function(e,t){D(e),A(t),S([])},serchedCustomers:w,onCustomerSearch:function(e){D(0),A(e.target.value);var a=e.target.value.toLowerCase();if(a.length<2)return S([]);t.getCustomers(a).then((function(e){S(e)}))}})),r.a.createElement(g.a.Footer,null,r.a.createElement(f.a,{bsStyle:"danger",className:"f-left",onClick:function(){return o(l.id)}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043d\u044f\u0442\u0438\u0435"),M)):r.a.createElement(r.a.Fragment,null)}),b=a(65),y=a(19),C=a(66),_=a(67),x=a(68),O=a.n(x),N=(a(140),a(141),a(142),a(143),a(144),function(){var e=Object(n.useContext)(u),t=Object(n.useState)(!1),a=Object(i.a)(t,2),c=a[0],s=a[1],d=Object(n.useState)({}),p=Object(i.a)(d,2),f=p[0],v=p[1],h=Object(n.useState)({}),g=Object(i.a)(h,2),x=g[0],N=g[1],j=x.events,w=x.groups,S=x.teachers,k=x.programs;Object(n.useEffect)((function(){Promise.all([e.getGroups(),e.getTeachers(),e.getPrograms()]).then((function(e){N({groups:e[0],teachers:e[1],programs:e[2]})}))}),[e]);var P=r.a.createRef(),T=function(){P.current.getApi().refetchEvents()},D=function(t){if(null===t.event.end&&!t.event.allDay){var a=+new Date(t.event.start)+36e5;t.event.setEnd(a)}e.updateEvent(t.event).then((function(e){}))};return w?r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-8"},r.a.createElement("div",{className:"bg-white"},r.a.createElement(b.a,{ref:P,locales:O.a,locale:"ru",height:"auto",defaultView:"timeGridWeek",allDayText:"\u0417\u0430\u0434\u0430\u0447\u0438",minTime:"09:00:00",maxTime:"21:00:00",timeFormat:"H(:mm)",selectable:!0,editable:!0,droppable:!0,navLinks:!0,displayEventEnd:!0,displayEventTime:!0,firstDay:1,eventLimit:!0,events:"".concat(e._apiBase,"/api/get-events"),loading:function(e){if(!e){var t=P.current.getApi().getEvents();N(Object(o.a)({},x,{events:t}))}},eventReceive:function(t){if(null===t.event.end&&!t.event.allDay){var a=+new Date(t.event.start)+36e5;t.event.setEnd(a)}var n=w[t.event.extendedProps.index],r={title:t.event.title,teacher_id:n?n.teacher_id:null,program_id:n?n.program_id:null,customers:n?n.customers:[],start:t.event.start,end:t.event.end,allDay:t.event.allDay};t.event.extendedProps.customer_id&&(r.customers=[{customer_id:t.event.extendedProps.customer_id}]),e.createEvent(r).then((function(e){T(),t.event.remove()}))},eventClick:function(e){s(!0);var t=j.findIndex((function(t){return t.id===e.event.id}));v(j[t])},eventDrop:D,eventResize:D,eventBorderColor:"transparent",plugins:[y.d,_.a,C.a,l.b],header:{left:"prev, next",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"}}))),r.a.createElement("div",{className:"col-md-4"},r.a.createElement(m,{groups:w}))),r.a.createElement(E,{modalIsOpen:c,onCloseModal:function(){s(!1)},currentEvent:f,onChangeTeacher:function(t){var a=j.findIndex((function(e){return e.id===f.id}));j[a].teacher_id=t.target.value,e.setTeacher(j[a]).then((function(e){var t=e.teacher&&e.teacher.color||"#3788d8";j[a].setProp("backgroundColor",t),T(),v(j[a])}))},onChangeProgram:function(t){var a=t.target.options[t.target.selectedIndex].text,n=f.extendedProps.customers,r=1===n.length?"".concat(n[0].customer.child_name," - ").concat(a):a,c=j.findIndex((function(e){return e.id===f.id}));j[c].setProp("title",r),j[c].program_id=t.target.value,e.setProgram(j[c]).then((function(e){T(),v(j[c])}))},teachers:S,programs:k,calendarEvents:j,onSaveClass:function(t){var a={event_id:f.id,updCustomers:t.filter((function(e){return e.update})),delCustomers:t.filter((function(e){return e.delete})).map((function(e){return e.id})),addCustomers:t.filter((function(e){return e.add}))};e.saveData(a).then((function(e){var t=j.findIndex((function(e){return e.id===f.id}));j[t].setExtendedProp("customers",e.customers),T(),v(j[t])}))},onDeleteClass:function(t){window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u0443 \u0437\u0430\u043f\u0438\u0441\u044c?")&&e.deleteEvent(t).then((function(){T(),s(!1)}))}})):"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u044e \u043a\u0430\u043b\u0435\u043d\u0434\u0430\u0440\u044c ..."}),j=a(5),w=a.n(j),S=a(69),k=new function e(){var t=this;Object(S.a)(this,e),this._apiBase="",this.getResource=function(e){var t,a,n=arguments;return w.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t=n.length>1&&void 0!==n[1]?n[1]:{},r.next=3,w.a.awrap(fetch(e,t));case 3:if((a=r.sent).ok){r.next=6;break}throw new Error("Could not fetch ".concat(e," , received ").concat(a.status));case 6:return r.next=8,w.a.awrap(a.json());case 8:return r.abrupt("return",r.sent);case 9:case"end":return r.stop()}}))},this.getPrograms=function(){return w.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.awrap(t.getResource("".concat(t._apiBase,"/api/get-programs")));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}))},this.getGroups=function(){return w.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.awrap(t.getResource("".concat(t._apiBase,"/api/get-groups")));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}))},this.getTeachers=function(){return w.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.awrap(t.getResource("".concat(t._apiBase,"/api/get-teachers")));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}))},this.getCustomers=function(e){return w.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,w.a.awrap(t.getResource("".concat(t._apiBase,"/api/get-customers"),{method:"POST",body:JSON.stringify({customer_name:e}),headers:{"content-type":"application/json"}}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}))},this.createEvent=function(e){var a,n,r,c,s,o,i;return w.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return a=e.title,n=e.start,r=e.end,c=e.allDay,s=e.teacher_id,o=e.program_id,i=e.customers,l.next=3,w.a.awrap(t.getResource("".concat(t._apiBase,"/api/set-event"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({title:a,start:n?n.getTime():null,end:r?r.getTime():null,all_day:c,teacher_id:s,program_id:o,customers:JSON.stringify(i)||!1})}));case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}}))},this.updateEvent=function(e){var a,n,r,c,s,o,i,l;return w.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return a=e.title,n=e.start,r=e.end,c=e.allDay,s=e.extendedProps,o=s.teacher_id,i=s.program_id,l=e.id||e.extendedProps.id,u.next=5,w.a.awrap(t.getResource("".concat(t._apiBase,"/api/set-event"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:l,title:a,start:n?n.getTime():null,end:r?r.getTime():null,all_day:c,teacher_id:o,program_id:i})}));case 5:return u.abrupt("return",u.sent);case 6:case"end":return u.stop()}}))},this.deleteEvent=function(e){return w.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,w.a.awrap(t.getResource("".concat(t._apiBase,"/api/delete-event/").concat(e),{method:"DELETE"}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}))},this.setTeacher=function(e){return w.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,w.a.awrap(t.getResource("".concat(t._apiBase,"/api/set-teacher"),{method:"POST",body:JSON.stringify({id:e.id,teacher_id:e.teacher_id}),headers:{"content-type":"application/json"}}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}))},this.setProgram=function(e){return w.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,w.a.awrap(t.getResource("".concat(t._apiBase,"/api/set-program?id=").concat(e.id,"&program_id=").concat(e.program_id,"&title=").concat(e.title),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:e.id,program_id:e.program_id,title:e.title})}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}))},this.saveData=function(e){return w.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,w.a.awrap(t.getResource("".concat(t._apiBase,"/api/save-class"),{method:"POST",body:JSON.stringify({obj:JSON.stringify(e)}),headers:{"content-type":"application/json"}}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}))}};s.a.render(r.a.createElement(u.Provider,{value:k},r.a.createElement(N,null)),document.getElementById("root"))},71:function(e,t,a){e.exports=a(146)},76:function(e,t,a){},77:function(e,t,a){}},[[71,1,2]]]);
//# sourceMappingURL=main.5428589b.chunk.js.map