(this.webpackJsonpjournal=this.webpackJsonpjournal||[]).push([[0],{111:function(e,t,a){},112:function(e,t,a){},145:function(e,t,a){},147:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(16),s=a.n(c),o=a(13),u=a(12),i=a(29),l=(a(75),function(e){var t=e.groups.map((function(e,t){return r.a.createElement("div",{className:"fc-event rs-groups__item",key:e.id,"data-index":t,"data-title":e.name,"data-program":e.program_id,"data-teacher":e.teacher_id},e.name)}));return Object(n.useEffect)((function(){var e=document.getElementById("external-events");new i.a(e,{itemSelector:".fc-event",eventData:function(e){return{index:e.getAttribute("data-index"),title:e.getAttribute("data-title"),program_id:e.getAttribute("data-program")||0,teacher_id:e.getAttribute("data-teacher")||0}}})}),[]),r.a.createElement("div",{id:"external-events"},r.a.createElement("div",{className:"col-md-12"},r.a.createElement("div",{className:"bg-white"},r.a.createElement("h4",null,"\u0418\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435"),r.a.createElement("div",{className:"fc-event rs-groups__item","data-index":"r1","data-title":"\u0418\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435","data-program":"","data-teacher":""},"\u041e\u0434\u0438\u043d\u043e\u0447\u043d\u043e\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u0435"))),r.a.createElement("div",{className:"col-md-12"},r.a.createElement("div",{className:"bg-white"},r.a.createElement("div",null,r.a.createElement("h4",null,"\u0413\u0440\u0443\u043f\u043f\u043e\u0432\u044b\u0435 \u0437\u0430\u043d\u044f\u0442\u0438\u044f"),t))))}),d=a(149),m=(a(76),function(e){var t=e.serchedCustomers,a=e.choosedCustomerName,n=e.onCustomerSearch,c=e.onCustomerChoose,s=e.onAddCustomer,o=t.map((function(e,t){return r.a.createElement("tr",{key:t,onClick:function(){return c(e.id,e.child_name)}},r.a.createElement("td",null,e.child_name))}));return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-10"},r.a.createElement("div",{className:"rs-order__customer"},r.a.createElement("label",{htmlFor:"class-search"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0435\u0431\u0451\u043d\u043a\u0430 \u043a \u0437\u0430\u043d\u044f\u0442\u0438\u044e"),r.a.createElement("input",{id:"class-search",onChange:n,value:a,type:"text",className:"form-control",placeholder:"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u0432\u0432\u043e\u0434\u0438\u0442\u044c \u0438\u043c\u044f ..."}),r.a.createElement("table",{className:"table rs-add-to-order"},r.a.createElement("tbody",{className:"rs-find-block"},o)))),r.a.createElement("div",{className:"col-md-2"},r.a.createElement(d.a,{bsStyle:"primary",onClick:s,className:"class-search__btn"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c")))}),h=(a(111),function(e){var t=Object(n.useState)(),a=Object(u.a)(t,2),c=a[0],s=a[1],o=e.customers,i=e.onDeleteCustomer,l=e.onChangeCustomerComment,m=e.onChangeCustomerScip,h=e.onChangeCustomerVisit;return Object(n.useEffect)((function(){var e=o.map((function(e,t){var a=e.scip?"rs-scip":"",n=e.visit?"rs-visit":"",c=e.delete?r.a.createElement(d.a,{onClick:function(){return i(e.id)},className:"class-customer-btn class-customer-delete"},r.a.createElement("span",{className:"glyphicon glyphicon-refresh"})):r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{onClick:function(){return i(e.id)},className:"class-customer-btn class-customer-delete"},r.a.createElement("span",{className:"glyphicon glyphicon-trash"})),r.a.createElement(d.a,{className:"class-customer-btn class-customer-scip ".concat(a),onClick:m,"data-id":e.id},r.a.createElement("span",{className:"glyphicon glyphicon-flash"})),r.a.createElement(d.a,{className:"class-customer-btn class-customer-visit ".concat(n),"data-id":e.id,onClick:h},r.a.createElement("span",{className:"glyphicon glyphicon-ok-circle"})));return r.a.createElement("tr",{key:t,className:e.delete?"rs-delete":e.add?"rs-add":""},r.a.createElement("td",null,t+1),r.a.createElement("td",{value:e.id},e.customer?e.customer.child_name:""),r.a.createElement("td",null,r.a.createElement("input",{type:"text",disabled:!!e.delete,"data-id":e.id,className:"form-control",onChange:l,value:e.comment||"",placeholder:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439 ..."})),r.a.createElement("td",null,c))}));s(e)}),[o,i,l,m,h]),r.a.createElement("tbody",null,c)}),f=a(148),p=(a(112),r.a.createContext()),v=function(e){var t=Object(n.useContext)(p),a=e.modalIsOpen,c=e.onCloseModal,s=e.onSaveClass,i=e.onDeleteClass,l=e.currentEvent,v=e.calendarEvents,g=e.onChangeTeacher,b=e.onChangeProgram,E=e.teacherOptions,j=e.programOptions,C=Object(n.useState)([]),O=Object(u.a)(C,2),x=O[0],y=O[1],w=Object(n.useState)([]),_=Object(u.a)(w,2),k=_[0],N=_[1],D=Object(n.useState)(0),S=Object(u.a)(D,2),T=S[0],I=S[1],R=Object(n.useState)(""),P=Object(u.a)(R,2),A=P[0],G=P[1];Object(n.useEffect)((function(){var e=l.extendedProps||l;if(e){var t=e.customers;y(t||[])}}),[l,v]);var F=function(e){x[e].update=!0;var t=[].concat(Object(o.a)(x.slice(0,e)),[x[e]],Object(o.a)(x.slice(e+1)));y(t)},B=x.length>0?"\u0421\u043f\u0438\u0441\u043e\u043a \u0434\u0435\u0442\u0435\u0439 \u043d\u0430 \u0437\u0430\u043d\u044f\u0442\u0438\u0438":"";return r.a.createElement(f.a,{show:a,bsSize:"large",onHide:c},r.a.createElement(f.a.Header,{closeButton:!0,style:{backgroundColor:l.backgroundColor}},r.a.createElement(f.a.Title,null,l.title||"\u0417\u0430\u043d\u044f\u0442\u0438\u0435 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e")),r.a.createElement(f.a.Body,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-6"},r.a.createElement("label",{htmlFor:"teacher-select"},"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c"),r.a.createElement("select",{className:"form-control",value:l.teacher_id,onChange:g},r.a.createElement("option",{value:"0"},"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d ..."),E)),r.a.createElement("div",{className:"col-md-6"},r.a.createElement("label",{htmlFor:"teacher-select"},"\u041f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430"),r.a.createElement("select",{className:"form-control",value:l.program_id,onChange:b},r.a.createElement("option",{value:"0"},"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u0430 ..."),j))),r.a.createElement("hr",null),r.a.createElement("table",{className:"table table-bordered table-hover"},r.a.createElement("caption",null,B),r.a.createElement(h,{customers:x,onChangeCustomerComment:function(e){var t=x.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));x[t].comment=e.currentTarget.value,F(t)},onChangeCustomerScip:function(e){var t=x.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));x[t].scip=!x[t].scip,F(t)},onChangeCustomerVisit:function(e){var t=x.findIndex((function(t){return t.id===e.currentTarget.getAttribute("data-id")}));x[t].visit=!x[t].visit,F(t)},onDeleteCustomer:function(e){var t=x.findIndex((function(t){return t.id===e}));if(x[t].add){var a=[].concat(Object(o.a)(x.slice(0,t)),Object(o.a)(x.slice(t+1)));return y(a)}x[t].delete=!x[t].delete,F(t)}})),r.a.createElement("hr",null),r.a.createElement(m,{onAddCustomer:function(){if(T){if(x.findIndex((function(e){return e.id===T}))+1)return!1;var e=[].concat(Object(o.a)(x),[{id:"s".concat(T),event_id:l.id,customer_id:T,customer:{child_name:A},add:!0}]);y(e),I(0),G("")}},choosedCustomerName:A,onCustomerChoose:function(e,t){I(e),G(t),N([])},serchedCustomers:k,onCustomerSearch:function(e){I(0),G(e.target.value);var a=e.target.value.toLowerCase();if(a.length<2)return N([]);t.getCustomers(a).then((function(e){N(e)}))}})),r.a.createElement(f.a.Footer,null,r.a.createElement(d.a,{bsStyle:"danger",className:"f-left",onClick:function(){return i(l.id)}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043d\u044f\u0442\u0438\u0435"),r.a.createElement(d.a,{bsStyle:"success",onClick:function(){return s(x)}},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c \u0437\u0430\u043d\u044f\u0442\u0438\u0435")))},g=a(65),b=a(21),E=a(66),j=a(67),C=a(68),O=a.n(C),x=(a(141),a(142),a(143),a(144),a(145),function(){var e=Object(n.useContext)(p),t=Object(n.useState)([]),a=Object(u.a)(t,2),c=a[0],s=a[1],d=Object(n.useState)({}),m=Object(u.a)(d,2),h=m[0],f=m[1],C=Object(n.useState)(!1),x=Object(u.a)(C,2),y=x[0],w=x[1],_=Object(n.useState)([]),k=Object(u.a)(_,2),N=k[0],D=k[1],S=Object(n.useState)([]),T=Object(u.a)(S,2),I=T[0],R=T[1],P=Object(n.useState)([]),A=Object(u.a)(P,2),G=A[0],F=A[1];Object(n.useEffect)((function(){e.getPrograms().then((function(e){return F(e)})),e.getTeachers().then((function(e){return R(e)})),e.getGroups().then((function(e){return s(e)})),e.getEvents().then((function(e){console.log("events",e);var t=e.map((function(e){return e.all_day>0&&(e.allDay=!0),e.start=new Date(1e3*e.start),e.end=new Date(1e3*e.end),e.backgroundColor=e.teacher&&e.teacher.color||"#3788d8",e}));D(t)}))}),[e]);var B=function(t){if(null===t.event.end&&!t.event.allDay){var a=+new Date(t.event.start)+36e5;t.event.setEnd(a)}e.updateEvent(t.event).then((function(e){var a=N.findIndex((function(t){return t.id===e.id}));e.start=t.event.start,e.end=t.event.end,e.allDay=t.event.allDay,e.backgroundColor=e.teacher&&e.teacher.color||"#3788d8",D([].concat(Object(o.a)(N.slice(0,a)),[e],Object(o.a)(N.slice(a+1))))}))},J=function(e){var t=N.findIndex((function(e){return e.id===h.id}));e.backgroundColor=e.teacher&&e.teacher.color||"#3788d8",e.start=N[t].start,e.end=N[t].end,e.allDay=N[t].allDay,f(e),D([].concat(Object(o.a)(N.slice(0,t)),[e],Object(o.a)(N.slice(t+1))))},H=I.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.surname," ",e.name," ",e.secondname)})),L=G.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.name)}));return r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-8"},r.a.createElement("div",{className:"bg-white"},r.a.createElement(g.a,{locales:O.a,locale:"ru",height:"auto",defaultView:"timeGridWeek",allDayText:"\u0417\u0430\u0434\u0430\u0447\u0438",minTime:"09:00:00",maxTime:"21:00:00",timeFormat:"H(:mm)",selectable:!0,editable:!0,droppable:!0,navLinks:!0,displayEventEnd:!0,displayEventTime:!0,firstDay:1,eventLimit:!0,events:N,eventReceive:function(t){if(null===t.event.end&&!t.event.allDay){var a=+new Date(t.event.start)+36e5;t.event.setEnd(a)}var n=c[t.event.extendedProps.index],r={title:n.name,teacher_id:n.teacher_id,program_id:n.program_id,customers:n.customers,start:t.event.start,end:t.event.end,allDay:t.event.allDay};e.createEvent(r).then((function(e){r.id=""+e.id,r.customers=e.customers,r.color=e.teacher.color,D([].concat(Object(o.a)(N),[r])),t.event.remove()}))},eventClick:function(e){w(!0);var t=N.findIndex((function(t){return t.id===e.event.id}));f(N[t])},eventDrop:B,eventResize:B,eventBorderColor:"transparent",plugins:[b.d,j.a,E.a,i.b],header:{left:"prev, next",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"}}))),r.a.createElement("div",{className:"col-md-4"},r.a.createElement(l,{groups:c}))),r.a.createElement(v,{modalIsOpen:y,onCloseModal:function(){w(!1)},currentEvent:h,onChangeTeacher:function(t){h.teacher_id=t.target.value,e.setTeacher(h).then((function(e){J(e)}))},onChangeProgram:function(t){h.title=t.target.options[t.target.selectedIndex].text,h.program_id=t.target.value,e.setProgram(h).then((function(e){J(e)}))},teacherOptions:H,programOptions:L,calendarEvents:N,setCalendarEvents:D,onSaveClass:function(t){var a={event_id:h.id,updCustomers:t.filter((function(e){return e.update})),delCustomers:t.filter((function(e){return e.delete})).map((function(e){return e.id})),addCustomers:t.filter((function(e){return e.add}))};e.saveData(a).then((function(e){J(e)}))},onDeleteClass:function(t){window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u0443 \u0437\u0430\u043f\u0438\u0441\u044c?")&&e.deleteEvent(t).then((function(){var e=N.findIndex((function(e){return e.id===h.id}));D([].concat(Object(o.a)(N.slice(0,e)),Object(o.a)(N.slice(e+1)))),w(!1)}))}}))}),y=a(5),w=a.n(y),_=a(15),k=a(69),N=new function e(){var t=this;Object(k.a)(this,e),this.getResource=function(){var e=Object(_.a)(w.a.mark((function e(t){var a,n,r=arguments;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,fetch(t,a);case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("Could not fetch ".concat(t," , received ").concat(n.status));case 6:return e.next=8,n.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getEvents=Object(_.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/get-events");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getPrograms=Object(_.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/get-programs");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getGroups=Object(_.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/get-groups");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getTeachers=Object(_.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/get-teachers");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.getCustomers=function(){var e=Object(_.a)(w.a.mark((function e(a){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/get-customers?customer_name=".concat(a),{method:"GET"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createEvent=function(){var e=Object(_.a)(w.a.mark((function e(a){var n,r,c,s,o,u,i,l,d;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.title,r=a.start,c=a.end,s=a.allDay,o=a.teacher_id,u=a.program_id,i=a.customers,l=r?r.getTime():null,d=c?c.getTime():null,e.next=5,t.getResource("https://schaste-crm/journal/set-event?title=".concat(n,"&start=").concat(l,"&end=").concat(d,"&all_day=").concat(s,"&teacher_id=").concat(o,"&program_id=").concat(u,"&customers=").concat(JSON.stringify(i)||!1),{method:"GET"});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateEvent=function(){var e=Object(_.a)(w.a.mark((function e(a){var n,r,c,s,o,u,i,l,d,m;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.title,r=a.start,c=a.end,s=a.allDay,o=a.extendedProps,u=o.teacher_id,i=o.program_id,l=r?r.getTime():null,d=c?c.getTime():null,m=a.id||a.extendedProps.id,e.next=7,t.getResource("https://schaste-crm/journal/set-event?id=".concat(m,"&title=").concat(n,"&start=").concat(l,"&end=").concat(d,"&all_day=").concat(s,"&teacher_id=").concat(u,"&program_id=").concat(i),{method:"GET"});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteEvent=function(){var e=Object(_.a)(w.a.mark((function e(a){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/delete-event?id=".concat(a));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setTeacher=function(){var e=Object(_.a)(w.a.mark((function e(a){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/set-teacher?id=".concat(a.id,"&teacher_id=").concat(a.teacher_id,"}"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setProgram=function(){var e=Object(_.a)(w.a.mark((function e(a){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/set-program?id=".concat(a.id,"&program_id=").concat(a.program_id,"&title=").concat(a.title));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.saveData=function(){var e=Object(_.a)(w.a.mark((function e(a){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("https://schaste-crm/journal/save-class?obj=".concat(JSON.stringify(a)));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};s.a.render(r.a.createElement(p.Provider,{value:N},r.a.createElement(x,null)),document.getElementById("root"))},70:function(e,t,a){e.exports=a(147)},75:function(e,t,a){},76:function(e,t,a){}},[[70,1,2]]]);
//# sourceMappingURL=main.f175a43b.chunk.js.map